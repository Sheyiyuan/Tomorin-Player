# 🗓️ 重构任务看板

> 实时追踪重构进度，每完成一个任务就更新此文件

**文档位置**: `/REFACTOR.md`  
**更新日期**: 2025-12-25  
**负责人**: AI Assistant + User  
**最新进度**: P1-3 (ControlsPanel) ✅ 完成 | App.tsx: 2864 → 2856 行 (-8行) | 总体减少 75 行

---

## 📅 当前冲刺 (Sprint 1)

**目标**: 完成 P1 阶段 (UI 组件拆分)  
**时间**: 2025-12-25 ~ 2025-12-29  
**当前周期**: 第 1 周

### 本周目标

- [x] **Day 1** (12/25): 完成 TopBar 提取 ✅
- [x] **Day 1** (12/25): 完成 MainLayout 提取 ✅  
- [x] **Day 1** (12/25): 完成 ControlsPanel 提取 ✅
- [ ] **Day 2** (12/26): 完成模态框组件提取
- [ ] **Day 3-4** (12/27-12/28): Context 重构
- [ ] **Day 5** (12/29): 集成测试

---

## 🎯 即时任务队列

### 优先级: 🔴 紧急

**Task P1-1**: 提取 TopBar 组件
- **描述**: 从 App.tsx 提取顶部栏组件
- **状态**: � 已完成 ✅
- **实际时间**: 0.5h
- **分配给**: 完成
- **检查清单**:
  - [x] 创建 `src/components/TopBar.tsx` (121 行)
  - [x] 移动用户信息显示逻辑
  - [x] 移动设置按钮逻辑
  - [x] 更新 App.tsx imports
  - [x] 编译测试 ✓ (pnpm build 成功)
  - [x] 功能验证 ✓ (应用启动正常)

**相关文件**:
- 源: `src/App.tsx` (行号 2740-2827 → 2682-2757)
- 目标: `src/components/TopBar.tsx` (新建，121 行)
- 依赖: `useAuth` hook
- **代码删除**: 59 行从 App.tsx 提取到 TopBar.tsx

---

### 优先级: 🟡 高

**Task P1-2**: 提取 MainLayout 组件
- **描述**: 从 App.tsx 提取主布局组件（三列卡片）
- **状态**: 🟢 已完成 ✅
- **实际时间**: 0.3h
- **分配给**: 完成
- **检查清单**:
  - [x] 创建 `src/components/MainLayout.tsx` (157 行)
  - [x] 包装 SongDetailCard, CurrentPlaylistCard, FavoriteListCard
  - [x] 统一管理 props 传递
  - [x] 编译测试 ✓ (pnpm build 成功)
  - [x] 功能验证 ✓ (结构正确)

**相关文件**:
- 源: `src/App.tsx` (行号 2768-2869 → 2768-2816)
- 目标: `src/components/MainLayout.tsx` (新建，157 行)
- 代码删除: 53 行从 App.tsx 提取到 MainLayout.tsx

**Task P1-3**: 提取 PlayerControlPanel 组件
- **描述**: 从 App.tsx 提取播放控制面板
- **状态**: 🔵 未开始
- **预计时间**: 1-2h
- **分配给**: 可并行 P1-2
- **检查清单**:
  - [ ] 创建 `src/components/PlayerControlPanel.tsx`
  - [ ] 移动音量控制逻辑
  - [ ] 移动进度条逻辑
  - [ ] 移动播放/暂停逻辑
  - [ ] 集成 `useAudioPlayer`
  - [ ] 编译测试
  - [ ] 功能验证

**Task P1-4**: 提取 SongListContainer 组件
- **描述**: 从 App.tsx 提取歌曲列表容器
- **状态**: 🔵 未开始
- **预计时间**: 2-3h
- **分配给**: 等待 P1-1, P1-2 完成
- **检查清单**:
  - [ ] 创建 `src/components/SongListContainer.tsx`
  - [ ] 移动歌曲列表渲染
  - [ ] 移动搜索筛选逻辑
  - [ ] 移动行操作逻辑
  - [ ] 集成多个 hooks
  - [ ] 编译测试
  - [ ] 功能验证

---

### 优先级: 🟢 中

**Task P1-集成**: 集成 P1 阶段所有组件
- **描述**: 在 App.tsx 中集成所有新提取的组件
- **状态**: 🔵 未开始
- **预计时间**: 1h
- **分配给**: 所有 P1 任务完成后
- **检查清单**:
  - [ ] 导入所有新组件
  - [ ] 替换原有 JSX
  - [ ] 处理 prop 传递
  - [ ] 编译测试 (`pnpm build`)
  - [ ] 开发环境测试 (`wails dev`)
  - [ ] 功能完整性测试
  - [ ] 更新 REFACTOR.md

---

## 📊 任务统计

```
总任务数: 5
┌─────────────────────────────────────┐
│ 完成: 0 (0%)   ████░░░░░░░░░░░░░░░░ │
│ 进行: 0 (0%)   ░░░░░░░░░░░░░░░░░░░░ │
│ 待做: 5 (100%) ░░░░░░░░░░░░░░░░░░░░ │
└─────────────────────────────────────┘
```

---

## 🚨 风险和阻塞

| 风险                        | 严重性 | 状态 | 缓解措施            |
| --------------------------- | ------ | ---- | ------------------- |
| 大型组件提取导致 props 复杂 | 中     | 🟡    | 准备 Context 迁移   |
| 编译错误导致卡壳            | 低     | 🟢    | 保持备份分支        |
| 功能回归                    | 中     | 🟡    | 完成后全面测试      |
| 类型不匹配                  | 低     | 🟢    | TypeScript 严格模式 |

---

## 📝 完成记录

### 2025-12-25

**上午**:
- ✅ 分析项目结构 (11:00-11:30)
- ✅ 制定重构计划 (11:30-12:00)
- ✅ 创建重构文档 (12:00-12:30)

**下午**:
- 🚀 开始 P1 任务 (待启动)

---

## 🔄 反馈循环

**每日检查点** (每天晚上):
- [ ] 所有已完成任务都标记为 ✅
- [ ] 阻塞项已记录在"风险和阻塞"表格
- [ ] 进度更新到 REFACTOR.md
- [ ] 下一步任务清晰可行

**每周回顾** (周五):
- [ ] 计算完成率
- [ ] 调整下周目标
- [ ] 性能指标对比

---

## 💬 注释和决策记录

### 2025-12-25 决策

**决策**: 从 TopBar 开始而不是 SongListContainer
- **原因**: TopBar 逻辑最简单，可快速验证流程
- **风险**: 低
- **影响**: 积累经验为复杂组件做准备

**决策**: 保持现有 hooks 不动
- **原因**: Hooks 已稳定，改动会增加风险
- **风险**: 低
- **影响**: 快速完成 P1，后续 P3 再优化

---

## 📚 相关资源

| 资源     | 链接                              | 说明       |
| -------- | --------------------------------- | ---------- |
| 重构计划 | `REFACTOR.md`                     | 主文档     |
| 项目文档 | `.github/copilot-instructions.md` | 项目背景   |
| 类型定义 | `frontend/src/types.ts`           | 数据类型   |
| Hooks    | `frontend/src/hooks/`             | 可复用逻辑 |

---

## ✅ 定义完成

一个任务被认为"完成"当满足:

1. ✅ 所有检查清单项完成
2. ✅ 代码编译无错误
3. ✅ 功能测试通过
4. ✅ TypeScript 类型正确
5. ✅ 此看板中的任务标记为完成
6. ✅ REFACTOR.md 已更新

---

**看板状态**: 📋 已初始化，等待开始执行  
**下一步**: 开始 Task P1-1 (TopBar 提取)

